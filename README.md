# 과제 관리 시스템

학생들의 과제 제출 현황을 분석하고 제출 파일을 자동으로 다운로드하는 Python 스크립트 모음입니다.

## 📋 목차

- [개요](#개요)
- [필요 라이브러리](#필요-라이브러리)
- [폴더 구조](#폴더-구조)
- [스크립트 설명](#스크립트-설명)
- [사용 방법](#사용-방법)
- [출력 파일](#출력-파일)
- [주의사항](#주의사항)

## 📖 개요

이 시스템은 해성여자고등학교의 과제 관리 JSON 데이터를 처리하여:
1. **학생별 과제 제출 현황을 CSV로 정리**
2. **제출된 파일들을 학생별 폴더로 자동 다운로드**

## 📦 필요 라이브러리

```bash
pip install requests
```

기본 라이브러리: `json`, `csv`, `os`, `glob`, `re`, `time`, `urllib.parse`, `collections`

## 📁 폴더 구조

```
프로젝트 폴더/
├── rawdata/                    # JSON 데이터 파일들
│   ├── 1st_class.json
│   ├── 2nd_class.json
│   └── ...
├── results/                    # CSV 분석 결과 (자동 생성)
│   ├── 1st_class.csv
│   ├── 2nd_class.csv
│   ├── summary.csv
│   └── detailed_summary.csv
├── downloads/                  # 다운로드된 파일들 (자동 생성)
│   ├── 1반/
│   │   ├── 강나린/
│   │   ├── 김철수/
│   │   └── ...
│   ├── 2반/
│   └── ...
├── student_assignments_to_csv.py
├── download_student_files.py
└── README.md
```

## 🔧 스크립트 설명

### 1. `student_assignments_to_csv.py`
**과제 제출 현황 분석 및 CSV 생성**

#### 주요 기능:
- JSON 파일에서 학생별 과제 제출 정보 추출
- `displayName`을 기준으로 학생 식별
- 첨부파일이 있는 과제만 필터링
- 학생별, 클래스별 통계 생성

#### 생성되는 파일:
- **개별 클래스 CSV**: `1st_class.csv`, `2nd_class.csv` 등
- **전체 요약**: `summary.csv`
- **상세 요약**: `detailed_summary.csv`

#### CSV 컬럼:
| 컬럼명 | 설명 |
|--------|------|
| 학생이름 | 학생의 displayName |
| 과제명 | 과제 제목 |
| 제출제목 | 학생이 입력한 제출 제목 |
| 파일형식 | 파일 MIME 타입 |
| 파일명 | 실제 파일명 |
| 제출일시 | 제출 날짜/시간 |
| 제출후기 | 학생이 작성한 후기 |
| 파일URL | Firebase 저장소 URL |

### 2. `download_student_files.py`
**학생별 과제 파일 자동 다운로드**

#### 주요 기능:
- 학생별 폴더 자동 생성
- Firebase URL에서 파일 다운로드
- 파일명 중복 처리
- 다운로드 실패 시 재시도 (최대 3회)
- 서버 부하 방지를 위한 다운로드 간격 조절

#### 특징:
- **한국어 폴더명**: `1st_class` → `1반`
- **안전한 파일명**: 특수문자 제거, 길이 제한
- **스마트 확장자**: 파일 타입에 따른 자동 확장자 추가
- **재시도 메커니즘**: 네트워크 오류 시 자동 재시도

## 🚀 사용 방법

### 1단계: 데이터 준비
```bash
# rawdata 폴더에 JSON 파일들 배치
mkdir rawdata
# JSON 파일들을 rawdata/ 폴더에 복사
```

### 2단계: 과제 현황 분석
```bash
python student_assignments_to_csv.py
```

**결과**: `results/` 폴더에 CSV 분석 파일들 생성

### 3단계: 파일 다운로드
```bash
python download_student_files.py
```

**결과**: `downloads/` 폴더에 학생별 과제 파일들 다운로드

## 📊 출력 파일

### CSV 분석 결과 (`results/` 폴더)

#### `summary.csv` - 전체 요약
```csv
파일명,학생수,제출건수,평균제출건수,상태
1st_class.json,28명,103건,3.7건/학생,성공
2nd_class.json,29명,123건,4.2건/학생,성공
```

#### `detailed_summary.csv` - 학생별 상세
```csv
파일명,학생이름,제출건수
1st_class.json,강나린,8건
1st_class.json,김철수,5건
```

#### 개별 클래스 파일 - 과제별 상세 정보
각 과제의 파일명, URL, 제출일시 등 모든 정보 포함

### 다운로드 결과 (`downloads/` 폴더)

```
downloads/
├── 1반/
│   ├── 강나린/
│   │   ├── AI활동지_1차시.pdf
│   │   ├── 프로젝트_보고서.hwp
│   │   └── 최종과제.hwpx
│   └── 김철수/
│       ├── 과제1.pdf
│       └── 과제2_1.hwp  # 중복 파일명 자동 처리
└── 2반/
    └── ...
```

## ⚠️ 주의사항

### 시스템 요구사항
- **Python 3.6+** 필요
- **인터넷 연결** 필요 (파일 다운로드)
- **충분한 저장 공간** (다운로드할 파일 크기에 따라)

### 사용 시 주의점

1. **서버 부하 방지**
   - 다운로드 간 0.5초 대기 시간 설정됨
   - 대량 다운로드 시 시간이 오래 걸릴 수 있음

2. **파일명 처리**
   - 특수문자는 자동으로 `_`로 변환
   - 중복 파일명은 `_1`, `_2` 등으로 자동 처리

3. **네트워크 오류**
   - 다운로드 실패 시 최대 3회 자동 재시도
   - 일부 파일이 실패해도 계속 진행

4. **메모리 사용**
   - 대용량 파일도 청크 단위로 다운로드하여 메모리 효율적

### 에러 해결

#### "폴더를 찾을 수 없습니다"
```bash
mkdir rawdata
# JSON 파일들을 rawdata/ 폴더에 배치
```

#### "모듈을 찾을 수 없습니다"
```bash
pip install requests
```

#### "다운로드 실패"
- 네트워크 연결 확인
- Firebase URL 유효성 확인
- 방화벽 설정 확인

## 📈 실행 예시

### CSV 생성 실행 결과
```
🔍 rawdata 폴더에서 JSON 파일들을 찾는 중...
📁 총 8개의 JSON 파일을 발견했습니다.
============================================================

🔄 처리 중: 1st_class.json
📄 1st_class.json
   👥 학생 수: 28명
   📝 제출 건수: 103건
   📋 학생별 제출 현황:
      • 강나린: 8건
      • 김철수: 5건
      ...
   ✅ CSV 생성: ./results/1st_class.csv

============================================================
📊 전체 처리 결과 요약
============================================================
📁 처리된 JSON 파일: 8개
✅ 성공적으로 처리된 파일: 8개
👥 총 처리된 학생 수: 229명
📝 총 제출 건수: 923건
📈 평균 제출 건수: 4.0건/학생
```

### 파일 다운로드 실행 결과
```
📁 1반 폴더를 생성했습니다.
   👤 강나린 처리 중...
    📥 다운로드 시도 1/3: AI활동지_1차시.pdf
        📊 파일 크기: 2,485,632 bytes
        ✅ 다운로드 완료
      📊 강나린: 8/8 파일 다운로드 성공

============================================================
📊 전체 다운로드 결과 요약
============================================================
👥 파일이 있는 학생: 185명
📥 총 다운로드 시도: 923건
✅ 성공적인 다운로드: 889건
❌ 실패한 다운로드: 34건
📈 성공률: 96.3%
```

---

## 📞 지원

문제가 발생하거나 개선 사항이 있으면 GitHub Issues를 통해 연락해주세요.

**최종 업데이트**: 2025년 6월 24일